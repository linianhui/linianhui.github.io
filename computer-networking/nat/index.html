<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=google-site-verification content="X6gTMGCy1-_vb5i3aja3ZZyzPY3raiKRJp4VIhOAX24"><meta name=msvalidate.01 content="CDE7502649B75529BD0FCFE89B056E38"><title>[计算机网络] NAT - Timetombs</title>
<link rel=icon type=image/svg href=/favicon.svg><link rel=stylesheet href=https://s4.zstatic.net/ajax/libs/normalize/8.0.1/normalize.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://s4.zstatic.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css crossorigin=anonymous referrerpolicy=no-referrer><link href='/asset/blog.css?time=2025-10-26T19%3a03%3a29Z%2b08%3a00' rel=stylesheet type=text/css><script src=https://s4.zstatic.net/npm/currency.js@2.0.4/dist/currency.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://s4.zstatic.net/ajax/libs/moment.js/2.30.1/moment.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src='/asset/blog.js?time=2025-10-26T19%3a03%3a29Z%2b08%3a00' type=application/javascript></script><script type=text/javascript>blog.isMobile()&&document.write('<link href="/asset/blog.mobile.css?time=2025-10-26T19%3A03%3A29Z%2B08%3A00" rel="stylesheet">')</script></head><body><div id=horizontal-progress class=horizontal-progress></div><aside id=toc class=toc><section class=toc-header><a class=toc-page-title href=/computer-networking/ target=_blank>[计算机网络]</a></section><section class=toc-page><a class=toc-page-title href=/computer-networking/00-overview/ target=_blank>[计算机网络] 00 概述</a></section><section class=toc-page><a class=toc-page-title href=/computer-networking/01-layer-physical/ target=_blank>[计算机网络] 01 [Layer] Physical</a></section><section class=toc-page><a class=toc-page-title href=/computer-networking/02-layer-data-link/ target=_blank>[计算机网络] 02 [Layer] Data Link</a></section><section class=toc-page><a class=toc-page-title href=/computer-networking/03-layer-internet/ target=_blank>[计算机网络] 03 [Layer] Internet</a></section><section class=toc-page><a class=toc-page-title href=/computer-networking/tcp/ target=_blank>[计算机网络] TCP</a></section><section class="toc-page selected"><span class=toc-page-title>[计算机网络] NAT</span><nav id=TableOfContents><ul><li><a href=#nat>1 NAT</a><ul><li><a href=#snat>1.1 SNAT</a></li><li><a href=#dnat>1.2 DNAT</a></li></ul></li><li><a href=#pat>2 PAT</a></li><li><a href=#napt>3 NAPT</a><ul><li><a href=#cone-nat>3.1 Cone NAT</a><ul><li><a href=#full-cone-nat>3.1.1 Full Cone NAT</a></li><li><a href=#address-restricted-cone-nat>3.1.2 Address Restricted Cone NAT</a></li><li><a href=#address-port-restricted-cone-nat>3.1.3 Address Port Restricted Cone NAT</a></li></ul></li><li><a href=#symmetric-nat>3.2 Symmetric NAT</a></li></ul></li><li><a href=#soluction>4 Soluction</a><ul><li><a href=#dmz>4.1 DMZ(Demilitarized Zone)</a></li><li><a href=#upnp>4.2 UPnP(Universal Plug and Play)</a></li></ul></li><li><a href=#reference>5 Reference</a></li></ul></nav></section><section class=toc-page><a class=toc-page-title href=/computer-networking/io-model/ target=_blank>[计算机网络] IO 模型</a></section><section class=toc-page><a class=toc-page-title href=/computer-networking/tool/ target=_blank>[计算机网络] Tool</a></section><section class=toc-page><a class=toc-page-title href=/computer-networking/dns/ target=_blank>[计算机网络] DNS(Domain Name System)</a></section><section class=toc-page><a class=toc-page-title href=/computer-networking/doh/ target=_blank>[计算机网络] DoH(DNS over HTTPS)</a></section><script type=text/javascript>blog.isPC()&&blog.toggleToc()</script></aside><main class=main><header class=header><hgroup class=header-hgroup><h1 class=header-hgroup-title><a href=/>Timetombs</a></h1><h2 class=header-hgroup-subtitle>泛义的工具是文明的基础，而确指的工具却是愚人的器物</h2></hgroup><nav class=header-nav><a class=header-nav-item href=/topic/ title=专题 target=_self><i class="fa fa-folder"></i>专题</a>
<a class=header-nav-item href=/tag/ title=标签 target=_self><i class="fa fa-tags"></i>标签</a>
<a class=header-nav-item href=/archive/ title=归档 target=_self><i class="fa fa-archive"></i>归档</a>
<a class=header-nav-item href=https://linianhui.cnblogs.com title=博客园 target=_black><img src=/asset/cnblogs.favicon.svg>博客园</a>
<a class=header-nav-item href=https://github.com/linianhui/blog title=GitHub target=_black><i class="fa fa-github"></i>GitHub</a></nav><div class=header-stats><div class=stats><span>共
<i>66<sub>h</sub>
</i>/
<i>118<sub>a</sub>
</i>篇</span><div class=stats-date>，更新于 2025-10-26T19:03:29Z+08:00 by &nbsp;
<a class=git-commit href=https://github.com/linianhui/blog/commit/2fac07e818d6d4ad6b78781efea82c28769c8c02 target=_blank><i class="fa fa-code-fork"></i>2fac07e</a></div></div><form class=search method=GET target=_blank action=https://www.bing.com/search><input name=q class=search-input type=search placeholder=search... results=5 onkeypress="search_param.value=search_param_site.value+this.value">
<input id=search_param_site type=hidden value="site:linianhui.github.io ">
<input name=q id=search_param type=hidden></form></div></header><main class=content><article class=article><h1 class=article-title>[计算机网络] NAT</h1><div class=article-copyright><span>版权声明 - </span><a href=/copyright/cc target=_blank>CC BY-NC-SA 4.0</a></div><section class=article-meta><section class=article-date>2020-02-20 21:20，约867字，阅读约2分钟</section><section class=article-topics><a class=article-topic href=/computer-networking/ title=[计算机网络] target=_blank><i class="fa fa-folder"></i>[计算机网络]</a></section><section class=article-tags><a class=article-tag href=/tag/dnat target=_blank><i class="fa fa-tag"></i>DNAT</a>
<a class=article-tag href=/tag/napt target=_blank><i class="fa fa-tag"></i>NAPT</a>
<a class=article-tag href=/tag/nat target=_blank><i class="fa fa-tag"></i>NAT</a>
<a class=article-tag href=/tag/pat target=_blank><i class="fa fa-tag"></i>PAT</a>
<a class=article-tag href=/tag/snat target=_blank><i class="fa fa-tag"></i>SNAT</a></section><section class=article-git><a class=article-git-commit href=https://github.com/linianhui/blog/commit/03e0cc08866458647d96951c1817c624518149d6 target=_blank><i class="fa fa-code-fork"></i>03e0cc0</a>
<span class=article-git-commit-subject>fix add displayed_on_home</span>
<span class=article-git-commit-time>2022-11-20 14:49</span>
<a class=article-git-source href=https://github.com/linianhui/blog/blob/main/src/computer-networking/nat/index.md target=_blank><i class="fa fa-github"></i>源码</a></section></section><section class=article-content><h1 id=nat><i id=locator-nat class=header-locator></i>
<a href=#nat class=article-h-a>1 NAT</a></h1><p><code>NAT</code>(Network Address Translation)<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> : 网络地址转换。是一种重写 <code>IP Packet</code> 的 <code>Source IP</code> 或 <code>Destination IP</code> 的技术，用来解决私有地址无法和外部通信的问题，也大大的缓解了IPv4的枯竭问题，同时促进了互联网的蓬勃发展。</p><p>假设原始的 <code>IP Packet</code> 如下 :</p><table><thead><tr><th style=text-align:left>Source IP</th><th style=text-align:left>Destination IP</th></tr></thead><tbody><tr><td style=text-align:left>192.168.2.2</td><td style=text-align:left>9.9.9.9</td></tr></tbody></table><h2 id=snat><i id=locator-snat class=header-locator></i>
<a href=#snat class=article-h-a>1.1 SNAT</a></h2><p><code>SNAT</code>(Source Network Address Translation) : 源地址转换，重写的是 <code>Source IP</code>。</p><p>重写后如下 :</p><table><thead><tr><th style=text-align:left>Source IP</th><th style=text-align:left>Destination IP</th></tr></thead><tbody><tr><td style=text-align:left><font color=#DC143C>1.1.1.1</font></td><td style=text-align:left>9.9.9.9</td></tr></tbody></table><h2 id=dnat><i id=locator-dnat class=header-locator></i>
<a href=#dnat class=article-h-a>1.2 DNAT</a></h2><p><code>DNAT</code>(Destination Network Address Translation) : 目标地址转换，重写的是 <code>Destination IP</code>。</p><p>重写后如下 :</p><table><thead><tr><th style=text-align:left>Source IP</th><th style=text-align:left>Destination IP</th></tr></thead><tbody><tr><td style=text-align:left>192.168.2.2</td><td style=text-align:left><font color=#009a61>2.2.2.2</font></td></tr></tbody></table><h1 id=pat><i id=locator-pat class=header-locator></i>
<a href=#pat class=article-h-a>2 PAT</a></h1><p><code>PAT</code>(Port Address Translation) : 端口地址转换(或者称为<code>Port Forwarding</code>)，是一种重写传输层的 <code>Source Port</code> 或者 <code>Destination Port</code> 的技术（隶属于 <code>NAT</code> 体系）。</p><p>假设原始的数据包如下 :</p><table><thead><tr><th style=text-align:left>Source IP</th><th style=text-align:left>Source Port</th><th style=text-align:left>Destination IP</th><th style=text-align:left>Destination Port</th></tr></thead><tbody><tr><td style=text-align:left>192.168.2.2</td><td style=text-align:left>6666</td><td style=text-align:left>9.9.9.9</td><td style=text-align:left>80</td></tr></tbody></table><p><code>Destination Port</code>重写后如下 :</p><table><thead><tr><th style=text-align:left>Source IP</th><th style=text-align:left>Source Port</th><th style=text-align:left>Destination IP</th><th style=text-align:left>Destination Port</th></tr></thead><tbody><tr><td style=text-align:left>192.168.2.2</td><td style=text-align:left>6666</td><td style=text-align:left>9.9.9.9</td><td style=text-align:left><font color=#1C86EE>8080</font></td></tr></tbody></table><h1 id=napt><i id=locator-napt class=header-locator></i>
<a href=#napt class=article-h-a>3 NAPT</a></h1><p>通常情况下NAT和PAT会被同时搭配组合使用, 这时通常称为 <code>NAPT</code>(Network Address Port Translation)。</p><p>比如最常见的例子是重写私有地址端口<code>192.168.2.2:6666</code>为公网的IP和端口<code>1.1.1.1:7777</code>，以此可以实现私有地址访问公网的目的。重写后如下 :</p><table><thead><tr><th style=text-align:left>Source IP</th><th style=text-align:left>Source Port</th><th style=text-align:left>Destination IP</th><th style=text-align:left>Destination Port</th></tr></thead><tbody><tr><td style=text-align:left><font color=#DC143C>1.1.1.1</font></td><td style=text-align:left><font color=#1C86EE>7777</font></td><td style=text-align:left>9.9.9.9</td><td style=text-align:left>80</td></tr></tbody></table><p>或者重写目标地址的IP和端口号。比如把发往 <code>9.9.9.9:80</code> 的数据重写为发往 <code>2.2.2.2:8080</code>，以此可以可以实现数据包转发的目的（如果可以动态的轮询转发给多个IP, 则也可以实现负载均衡的目的）。重写后如下 :</p><table><thead><tr><th style=text-align:left>Source IP</th><th style=text-align:left>Source Port</th><th style=text-align:left>Destination IP</th><th style=text-align:left>Destination Port</th></tr></thead><tbody><tr><td style=text-align:left>192.168.2.2</td><td style=text-align:left>6666</td><td style=text-align:left><font color=#009a61>2.2.2.2</font></td><td style=text-align:left><font color=#1C86EE>8080</font></td></tr></tbody></table><p>根据NAPT设备对转换的策略，可以得到一下4种类型的NAPT。示例如下 :</p><table style=text-align:left><tr><th colspan=2>Type</th><th>Source > Destination</th><th>NAPT</th><th>NAPT Allowed IP</th><th>NAPT Allowed Port</th></tr><tr><td rowspan=6>Cone</td><td rowspan=2>Full</td><td>192.168.2.2:6666 > 9.9.9.9:80</td><td rowspan=2>1.1.1.1:7777</td><td>any</td><td>any</td></tr><tr><td>192.168.2.2:6666 > 2.2.2.2:33</td><td>any</td><td>any</td></tr><tr><td rowspan=2>Address Restricted</td><td>192.168.2.2:6666 > 9.9.9.9:80</td><td rowspan=2>1.1.1.1:7777</td><td>9.9.9.9</td><td>any</td></tr><tr><td>192.168.2.2:6666 > 2.2.2.2:33</td><td>2.2.2.2</td><td>any</td></tr><tr><td rowspan=2>Address Port Restricted</td><td>192.168.2.2:6666 > 9.9.9.9:80</td><td rowspan=2>1.1.1.1:7777</td><td>9.9.9.9</td><td>80</td></tr><tr><td>192.168.2.2:6666 > 2.2.2.2:33</td><td>2.2.2.2</td><td>33</td></tr><tr><td rowspan=2 colspan=2>Symmetric</td><td>192.168.2.2:6666 > 9.9.9.9:80</td><td>1.1.1.1:7777</td><td>9.9.9.9</td><td>80</td></tr><tr><td>192.168.2.2:6666 > 2.2.2.2:33</td><td>1.1.1.1:7878</td><td>2.2.2.2</td><td>33</td></tr></table><h2 id=cone-nat><i id=locator-cone-nat class=header-locator></i>
<a href=#cone-nat class=article-h-a>3.1 Cone NAT</a></h2><p>由 <code>Source</code> 方发送数据包触发，根据 <code>Source IP:Source Port</code> 为唯一标识，在NAPT中建立映射关系(即使 <code>Destination</code> 不同也只会建立一个映射关系)。</p><h3 id=full-cone-nat><i id=locator-full-cone-nat class=header-locator></i>
<a href=#full-cone-nat class=article-h-a>3.1.1 Full Cone NAT</a></h3><p>映射建立后，允许外部的 <font color=#009a61>Any IP</font> : <font color=#009a61>Any Port</font> 访问映射的 <code>NAT IP:NAT Port</code>。</p><img src=full-cone.svg loading=lazy decoding=auto alt="Full Cone NAT" title="Full Cone NAT"><h3 id=address-restricted-cone-nat><i id=locator-address-restricted-cone-nat class=header-locator></i>
<a href=#address-restricted-cone-nat class=article-h-a>3.1.2 Address Restricted Cone NAT</a></h3><p>映射建立后，允许外部的 <font color=#EEC900>Destination IP</font> : <font color=#009a61>Any Port</font> 访问映射的 <code>NAT IP:NAT Port</code>。</p><img src=address-restricted-cone.svg loading=lazy decoding=auto alt="Address Restricted Cone NAT" title="Address Restricted Cone NAT"><h3 id=address-port-restricted-cone-nat><i id=locator-address-port-restricted-cone-nat class=header-locator></i>
<a href=#address-port-restricted-cone-nat class=article-h-a>3.1.3 Address Port Restricted Cone NAT</a></h3><p>映射建立后，允许外部的 <font color=#EEC900>Destination IP</font> : <font color=#EEC900>Destination Port</font> 访问映射的 <code>NAT IP:NAT Port</code>。</p><img src=address-port-restricted-cone.svg loading=lazy decoding=auto alt="Port Restricted Cone NAT" title="Port Restricted Cone NAT"><h2 id=symmetric-nat><i id=locator-symmetric-nat class=header-locator></i>
<a href=#symmetric-nat class=article-h-a>3.2 Symmetric NAT</a></h2><p>由<code>Source</code>方发送数据包触发，根据 <code>Source IP:Source Port</code> 和 <code>Destination IP:Destination Port</code> 为唯一标识，在NAPT中建立映射关系。</p><p>映射建立后，允许外部的 <font color=#EEC900>Destination IP</font> : <font color=#EEC900>Destination Port</font> 访问映射的 <code>NAT IP:NAT Port</code>。</p><img src=symmetric.svg loading=lazy decoding=auto alt="Symmetric NAT" title="Symmetric NAT"><h1 id=soluction><i id=locator-soluction class=header-locator></i>
<a href=#soluction class=article-h-a>4 Soluction</a></h1><h2 id=dmz><i id=locator-dmz class=header-locator></i>
<a href=#dmz class=article-h-a>4.1 DMZ(Demilitarized Zone)</a></h2><p><a href=https://en.wikipedia.org/wiki/DMZ_%28computing%29 target=_blank rel="noopener norefferrer">https://en.wikipedia.org/wiki/DMZ_(computing)</a></p><h2 id=upnp><i id=locator-upnp class=header-locator></i>
<a href=#upnp class=article-h-a>4.2 UPnP(Universal Plug and Play)</a></h2><p><a href=https://en.wikipedia.org/wiki/Universal_Plug_and_Play target=_blank rel="noopener norefferrer">https://en.wikipedia.org/wiki/Universal_Plug_and_Play</a></p><h1 id=reference><i id=locator-reference class=header-locator></i>
<a href=#reference class=article-h-a>5 Reference</a></h1><p><a href=https://tools.ietf.org/html/rfc2663 target=_blank rel="noopener norefferrer">https://tools.ietf.org/html/rfc2663</a></p><p><a href="https://www.youtube.com/watch?v=QBqPzHEDzvo" target=_blank rel="noopener norefferrer">https://www.youtube.com/watch?v=QBqPzHEDzvo</a></p><p><a href="https://www.youtube.com/watch?v=wg8Hosr20yw" target=_blank rel="noopener norefferrer">https://www.youtube.com/watch?v=wg8Hosr20yw</a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>NAT : <a href=https://en.wikipedia.org/wiki/Network_address_translation target=_blank rel="noopener norefferrer">https://en.wikipedia.org/wiki/Network_address_translation</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></section><section class=article-meta><section class=article-date>2020-02-20 21:20，约867字，阅读约2分钟</section><section class=article-topics><a class=article-topic href=/computer-networking/ title=[计算机网络] target=_blank><i class="fa fa-folder"></i>[计算机网络]</a></section><section class=article-tags><a class=article-tag href=/tag/dnat target=_blank><i class="fa fa-tag"></i>DNAT</a>
<a class=article-tag href=/tag/napt target=_blank><i class="fa fa-tag"></i>NAPT</a>
<a class=article-tag href=/tag/nat target=_blank><i class="fa fa-tag"></i>NAT</a>
<a class=article-tag href=/tag/pat target=_blank><i class="fa fa-tag"></i>PAT</a>
<a class=article-tag href=/tag/snat target=_blank><i class="fa fa-tag"></i>SNAT</a></section><section class=article-git><a class=article-git-commit href=https://github.com/linianhui/blog/commit/03e0cc08866458647d96951c1817c624518149d6 target=_blank><i class="fa fa-code-fork"></i>03e0cc0</a>
<span class=article-git-commit-subject>fix add displayed_on_home</span>
<span class=article-git-commit-time>2022-11-20 14:49</span>
<a class=article-git-source href=https://github.com/linianhui/blog/blob/main/src/computer-networking/nat/index.md target=_blank><i class="fa fa-github"></i>源码</a></section></section><section class=article-page><div class=article-page-prev><span>上一篇 : </span><a href=/computer-networking/tcp/ target=_blank>[计算机网络] TCP</a></div><div class=article-page-next><span>下一篇 : </span><a href=/computer-networking/io-model/ target=_blank>[计算机网络] IO 模型</a></div></section></article><section id=article-comment class=article-comment><script src=https://utteranc.es/client.js repo=linianhui/blog issue-term=pathname label=blog-comment theme=github-light crossorigin=anonymous async></script></section></main><footer class=footer><section>Copyright © 2025 by <a href=https://github.com/linianhui/blog target=_blank>Timetombs</a></section><section><a class=article-git-commit href=https://github.com/linianhui/blog/commit/2fac07e818d6d4ad6b78781efea82c28769c8c02 target=_blank><i class="fa fa-code-fork"></i>2fac07e</a>
Powered by
<a href=https://github.com/actions target=_blank>GitHub Actions</a>
,
<a href=https://github.com/gohugoio/hugo target=_blank>Hugo</a>
and
<a href=https://github.com/utterance/utterances target=_blank>utterances</a>
Hosted on <a href=https://pages.github.com/ target=_blank>GitHub Pages</a><section></footer></main><aside class=toolbar><a class="fa fa-list" href=javascript:blog.toggleToc(); title=目录></a><a class="fa fa-comments" href=#article-comment title=评论></a><a class="fa fa-arrow-up" href=javascript:scroll(0,0); title=返回顶部></a></aside><script type=text/javascript>var _hmt=_hmt||[];blog.addOnScorllEvent()</script><script src=https://hm.baidu.com/hm.js?b2cc3cea316e1f7a8def1bab8dc98fad async></script></body></html>