<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=google-site-verification content="X6gTMGCy1-_vb5i3aja3ZZyzPY3raiKRJp4VIhOAX24"><meta name=msvalidate.01 content="CDE7502649B75529BD0FCFE89B056E38"><title>[计算机网络] 02 [Layer] Data Link - Timetombs</title>
<link rel=icon type=image/svg href=/favicon.svg><link rel=stylesheet href=https://s4.zstatic.net/ajax/libs/normalize/8.0.1/normalize.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://s4.zstatic.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css crossorigin=anonymous referrerpolicy=no-referrer><link href='/asset/blog.css?time=2025-10-26T19%3a03%3a29Z%2b08%3a00' rel=stylesheet type=text/css><script src=https://s4.zstatic.net/npm/currency.js@2.0.4/dist/currency.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://s4.zstatic.net/ajax/libs/moment.js/2.30.1/moment.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src='/asset/blog.js?time=2025-10-26T19%3a03%3a29Z%2b08%3a00' type=application/javascript></script><script type=text/javascript>blog.isMobile()&&document.write('<link href="/asset/blog.mobile.css?time=2025-10-26T19%3A03%3A29Z%2B08%3A00" rel="stylesheet">')</script></head><body><div id=horizontal-progress class=horizontal-progress></div><aside id=toc class=toc><section class=toc-header><a class=toc-page-title href=/computer-networking/ target=_blank>[计算机网络]</a></section><section class=toc-page><a class=toc-page-title href=/computer-networking/00-overview/ target=_blank>[计算机网络] 00 概述</a></section><section class=toc-page><a class=toc-page-title href=/computer-networking/01-layer-physical/ target=_blank>[计算机网络] 01 [Layer] Physical</a></section><section class="toc-page selected"><span class=toc-page-title>[计算机网络] 02 [Layer] Data Link</span><nav id=TableOfContents><ul><li><a href=#data-link-purpose>1 数据链路层的用途</a></li><li><a href=#three-basic-question>2 三个基本问题</a><ul><li><a href=#encapsulation-into-frame>2.1 封装成帧</a></li><li><a href=#transparent-transmission>2.2 透明传输</a></li><li><a href=#error-detection>2.3 差错检测</a></li></ul></li><li><a href=#mac>3 MAC</a></li><li><a href=#ethernet-frame>4 Ethernet Frame</a><ul><li><a href=#dic-ethernet-v2-frame>4.1 DIX Ethernet V2 Frame</a><ul><li><a href=#entre-type>4.1.1 Enter Type</a></li></ul></li><li><a href=#ieee-802-3-frame>4.2 IEEE 802.3 Frame</a></li><li><a href=#frame-type>4.3 Frame Type</a></li></ul></li><li><a href=#arp>5 ARP</a></li><li><a href=#valn>6 VLAN</a><ul><li><a href=#ieee-802-1q-frame>6.1 IEEE 802.1Q Frame</a></li></ul></li><li><a href=#device>7 设备</a><ul><li><a href=#switch>7.1 交换机</a></li></ul></li><li><a href=#summary>8 总结</a></li><li><a href=#leftover-problem>9 遗留问题</a></li><li><a href=#reference>10 Reference</a></li></ul></nav></section><section class=toc-page><a class=toc-page-title href=/computer-networking/03-layer-internet/ target=_blank>[计算机网络] 03 [Layer] Internet</a></section><section class=toc-page><a class=toc-page-title href=/computer-networking/tcp/ target=_blank>[计算机网络] TCP</a></section><section class=toc-page><a class=toc-page-title href=/computer-networking/nat/ target=_blank>[计算机网络] NAT</a></section><section class=toc-page><a class=toc-page-title href=/computer-networking/io-model/ target=_blank>[计算机网络] IO 模型</a></section><section class=toc-page><a class=toc-page-title href=/computer-networking/tool/ target=_blank>[计算机网络] Tool</a></section><section class=toc-page><a class=toc-page-title href=/computer-networking/dns/ target=_blank>[计算机网络] DNS(Domain Name System)</a></section><section class=toc-page><a class=toc-page-title href=/computer-networking/doh/ target=_blank>[计算机网络] DoH(DNS over HTTPS)</a></section><script type=text/javascript>blog.isPC()&&blog.toggleToc()</script></aside><main class=main><header class=header><hgroup class=header-hgroup><h1 class=header-hgroup-title><a href=/>Timetombs</a></h1><h2 class=header-hgroup-subtitle>泛义的工具是文明的基础，而确指的工具却是愚人的器物</h2></hgroup><nav class=header-nav><a class=header-nav-item href=/topic/ title=专题 target=_self><i class="fa fa-folder"></i>专题</a>
<a class=header-nav-item href=/tag/ title=标签 target=_self><i class="fa fa-tags"></i>标签</a>
<a class=header-nav-item href=/archive/ title=归档 target=_self><i class="fa fa-archive"></i>归档</a>
<a class=header-nav-item href=https://linianhui.cnblogs.com title=博客园 target=_black><img src=/asset/cnblogs.favicon.svg>博客园</a>
<a class=header-nav-item href=https://github.com/linianhui/blog title=GitHub target=_black><i class="fa fa-github"></i>GitHub</a></nav><div class=header-stats><div class=stats><span>共
<i>66<sub>h</sub>
</i>/
<i>118<sub>a</sub>
</i>篇</span><div class=stats-date>，更新于 2025-10-26T19:03:29Z+08:00 by &nbsp;
<a class=git-commit href=https://github.com/linianhui/blog/commit/2fac07e818d6d4ad6b78781efea82c28769c8c02 target=_blank><i class="fa fa-code-fork"></i>2fac07e</a></div></div><form class=search method=GET target=_blank action=https://www.bing.com/search><input name=q class=search-input type=search placeholder=search... results=5 onkeypress="search_param.value=search_param_site.value+this.value">
<input id=search_param_site type=hidden value="site:linianhui.github.io ">
<input name=q id=search_param type=hidden></form></div></header><main class=content><article class=article><h1 class=article-title>[计算机网络] 02 [Layer] Data Link</h1><div class=article-copyright><span>版权声明 - </span><a href=/copyright/cc target=_blank>CC BY-NC-SA 4.0</a></div><section class=article-meta><section class=article-date>2019-09-22 08:12，约3237字，阅读约7分钟</section><section class=article-topics><a class=article-topic href=/computer-networking/ title=[计算机网络] target=_blank><i class="fa fa-folder"></i>[计算机网络]</a></section><section class=article-tags><a class=article-tag href=/tag/arp target=_blank><i class="fa fa-tag"></i>ARP</a>
<a class=article-tag href=/tag/crc target=_blank><i class="fa fa-tag"></i>CRC</a>
<a class=article-tag href=/tag/eot target=_blank><i class="fa fa-tag"></i>EOT</a>
<a class=article-tag href=/tag/esc target=_blank><i class="fa fa-tag"></i>ESC</a>
<a class=article-tag href=/tag/fcs target=_blank><i class="fa fa-tag"></i>FCS</a>
<a class=article-tag href=/tag/frame target=_blank><i class="fa fa-tag"></i>Frame</a>
<a class=article-tag href=/tag/icmpv6 target=_blank><i class="fa fa-tag"></i>ICMPv6</a>
<a class=article-tag href=/tag/l2-switch target=_blank><i class="fa fa-tag"></i>L2 Switch</a>
<a class=article-tag href=/tag/mac target=_blank><i class="fa fa-tag"></i>MAC</a>
<a class=article-tag href=/tag/mtu target=_blank><i class="fa fa-tag"></i>MTU</a>
<a class=article-tag href=/tag/soh target=_blank><i class="fa fa-tag"></i>SOH</a>
<a class=article-tag href=/tag/switch target=_blank><i class="fa fa-tag"></i>Switch</a>
<a class=article-tag href=/tag/%E4%BA%8C%E5%B1%82%E4%BA%A4%E6%8D%A2%E6%9C%BA target=_blank><i class="fa fa-tag"></i>二层交换机</a>
<a class=article-tag href=/tag/%E4%BA%A4%E6%8D%A2%E6%9C%BA target=_blank><i class="fa fa-tag"></i>交换机</a>
<a class=article-tag href=/tag/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E6%9C%BA target=_blank><i class="fa fa-tag"></i>以太网交换机</a>
<a class=article-tag href=/tag/%E5%B0%81%E8%A3%85%E6%88%90%E5%B8%A7 target=_blank><i class="fa fa-tag"></i>封装成帧</a>
<a class=article-tag href=/tag/%E5%B7%AE%E9%94%99%E6%A3%80%E6%B5%8B target=_blank><i class="fa fa-tag"></i>差错检测</a>
<a class=article-tag href=/tag/%E9%80%8F%E6%98%8E%E4%BC%A0%E8%BE%93 target=_blank><i class="fa fa-tag"></i>透明传输</a></section><section class=article-git><a class=article-git-commit href=https://github.com/linianhui/blog/commit/03e0cc08866458647d96951c1817c624518149d6 target=_blank><i class="fa fa-code-fork"></i>03e0cc0</a>
<span class=article-git-commit-subject>fix add displayed_on_home</span>
<span class=article-git-commit-time>2022-11-20 14:49</span>
<a class=article-git-source href=https://github.com/linianhui/blog/blob/main/src/computer-networking/02-layer-data-link/index.md target=_blank><i class="fa fa-github"></i>源码</a></section></section><section class=article-content><h1 id=data-link-purpose><i id=locator-data-link-purpose class=header-locator></i>
<a href=#data-link-purpose class=article-h-a>1 数据链路层的用途</a></h1><p>上一篇的遗留问题说到物理层仅仅提供<code>01</code>bit流是远远不够的，需要进行更高层的抽象。结合开篇中提到的计算机网络的核心设计理念<strong>分组&交换</strong>，这一层的用途就是分组 : 提供基于<code>01</code>bit流分组后的数据帧(<code>PDU=Frame</code>)。</p><img src=bit-frame.png loading=lazy decoding=auto alt title><h1 id=three-basic-question><i id=locator-three-basic-question class=header-locator></i>
<a href=#three-basic-question class=article-h-a>2 三个基本问题</a></h1><p>想要从下层的<code>01</code>比特中抽象出这样的结果，则需要解决一下的三个基本问题：</p><ol><li>封装成帧。</li><li>透明传输。</li><li>差错检测。</li></ol><h2 id=encapsulation-into-frame><i id=locator-encapsulation-into-frame class=header-locator></i>
<a href=#encapsulation-into-frame class=article-h-a>2.1 封装成帧</a></h2><p>下层物理层提供的是<code>01</code>bit流，想要变成分组后的帧，就需要定义起始和结束的标记。</p><ol><li>起始标识 : <code>SOH(Start Of Headine)</code>，二进制<code>0000_0001</code>。</li><li>结束标识 : <code>EOT(End Of Transmission)</code>，二进制<code>0000_0100</code>。</li></ol><img src=encapsulation-into-frame.svg loading=lazy decoding=auto alt=封装成帧 title=封装成帧><p>发送方会在Frame前后插入<code>SOH</code>和<code>EOT</code>。接受方会读取这2个标记中间的数据。每一个链路层协议对<code>Frame</code>的长度都有约束，称为<code>MTU(Maximum Transfer Unit)</code>.</p><h2 id=transparent-transmission><i id=locator-transparent-transmission class=header-locator></i>
<a href=#transparent-transmission class=article-h-a>2.2 透明传输</a></h2><p>有了<code>SOH</code>和<code>EOT</code>还是远远不够的，设想一下当你要传输的数据中正好也包含这两个标记，那么我们的起始和结束岂不就错乱了？对的，正是如此，所以就需要找一个办法来识别出这种数据。这个办法就是转义，即通过添加一个新的符号来改变<code>SOH</code>和<code>EOT</code>的含义。</p><ul><li>转义符号 : <code>ESC(Escape)</code>，二进制<code>0001_1011</code>。</li></ul><img src=transparent-transmission.svg loading=lazy decoding=auto alt=透明传输 title=透明传输><p>发送方会检查Frame，然后在需要转义的地方加入<code>ESC</code>。接受方读取<code>Frame</code>时会检查是否同时出现了<code>ESC SOH</code>、<code>ESC ESC</code>和<code>ESC EOT</code>，有的话就移除<code>ESC</code>，然后把后续的一个<code>Octet</code>当作正常的数据。</p><h2 id=error-detection><i id=locator-error-detection class=header-locator></i>
<a href=#error-detection class=article-h-a>2.3 差错检测</a></h2><p>终于可以完成的对下层的<code>01</code>进行分组了。但是在传输过程中可能会发生差错，比如把<code>0</code>处理成了<code>1</code>，或者过来，再或者丢了一些数据，为了保证其完整性，就需要对其进行差错检测。这时就需要把一些校验码放在<code>Frame</code>的后面(<code>EOT</code>的前面)，这个校验码称为帧检测序列<code>FCS(Frame Check Sequence)</code>。生成校验码的方式通常是<code>CRC(Cyclic Redundancy Check)</code>，具体的算法就不展开了。</p><img src=error-detection.svg loading=lazy decoding=auto alt=差错检测 title=差错检测><p>如果接受方接收到数据后检测发现<code>FCS</code>对不上，则会丢弃这个<code>Frame</code>。从这个差错检测也可以反向推断出来，如果不分组成<code>Frame</code>，则就无法进行差错检测了。</p><h1 id=mac><i id=locator-mac class=header-locator></i>
<a href=#mac class=article-h-a>3 MAC</a></h1><p>在<code>LAN</code>中，通信双方需要一个标识符来标识通信双方，这个标识符就是<code>MAC Address(Media Access Control Address)</code><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>，也称为物理地址，后续就称为<code>MAC</code>了。这个标识符长度为<code>48bit</code>，是固化到硬件中的。前<code>24</code>位由IEEE负责分配（硬件厂商向其购买），后<code>24</code>位硬件厂商自己分配。MAC地址并不是全球唯一的，也不需要全球唯一，在一个<code>LAN</code>内唯一即可。</p><h1 id=ethernet-frame><i id=locator-ethernet-frame class=header-locator></i>
<a href=#ethernet-frame class=article-h-a>4 Ethernet Frame</a></h1><p><code>Enternet(以太网)</code>是美国施乐(Xerox)公司在1975年开发出来的一种<code>LAN(Local Area Network)局域网</code>技术。<code>Enter(以太)</code>来自于当时物理学中的<code>以太</code>理论(当时的科学家认为电磁波的传播介质是以太)。</p><p>1980年9月，DEC、Intel和Xerox三家公司联合制定了一个10Mbit/s的协议<code>DIX V1</code>。1982年又做了一些修改，也就是目前所使用的<code>DIX V2</code><sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>。</p><h2 id=dic-ethernet-v2-frame><i id=locator-dic-ethernet-v2-frame class=header-locator></i>
<a href=#dic-ethernet-v2-frame class=article-h-a>4.1 DIX Ethernet V2 Frame</a></h2><p>DIX V2的Frame<sup id=fnref1:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>:</p><div class="highlight-file highlight-file_opened" id=hf-64206f854bac6ee92a18477f6a3f24b5><div class=highlight-file-header><a class="fa fa-plus highlight-file-switch" onclick='blog.toggleClassName("hf-64206f854bac6ee92a18477f6a3f24b5","highlight-file_opened")'>dix-ethernet-v2-frame.txt</a><a class="fa fa-download highlight-file-download" target=_blank href=/computer-networking/02-layer-data-link/dix-ethernet-v2-frame.txt title="下载 dix-ethernet-v2-frame.txt" download></a>
<a class="fa fa-github" target=_blank href=https://github.com/linianhui/blog/blob/main/src/computer-networking/02-layer-data-link/dix-ethernet-v2-frame.txt title="源码 dix-ethernet-v2-frame.txt"></a></div><div class=highlight-file-content><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>|                DIX Ethernet V2 Frame                          |
</span></span><span style=display:flex><span>|- - - - - - - -+- - - 32 bit(4 octet) - - - - -+- - - - - - - -|
</span></span><span style=display:flex><span>|0 1 2 3 4 5 6 7+0 1 2 3 4 5 6 7+0 1 2 3 4 5 6 7+0 1 2 3 4 5 6 7|
</span></span><span style=display:flex><span>|- - - - - - - -+- - - - - - - -+- - - - - - - -+- - - - - - - -|
</span></span><span style=display:flex><span>|           Destination MAC Address (6 octet)                   |
</span></span><span style=display:flex><span>|                               +- - - - - - - -+- - - - - - - -|
</span></span><span style=display:flex><span>|                               |                               |
</span></span><span style=display:flex><span>|- - - - - - - -+- - - - - - - -+                               |
</span></span><span style=display:flex><span>|           Source MAC Address (6 octet)                        |
</span></span><span style=display:flex><span>|- - - - - - - -+- - - - - - - -+- - - - - - - -+- - - - - - - -|
</span></span><span style=display:flex><span>|        Type (2 octet)        |                                |
</span></span><span style=display:flex><span>|- - - - - - - -+- - - - - - - -+                               |
</span></span><span style=display:flex><span>|                                                               |
</span></span><span style=display:flex><span>|               Payload (46-1500 octet)                         |
</span></span><span style=display:flex><span>|                                                               |
</span></span><span style=display:flex><span>|- - - - - - - -+- - - - - - - -+- - - - - - - -+- - - - - - - -|
</span></span><span style=display:flex><span>|                        CRC (4 octet)                          |
</span></span><span style=display:flex><span>|- - - - - - - -+- - - - - - - -+- - - - - - - -+- - - - - - - -|</span></span></code></pre></div></div></div><p>这个协议中规定了Frame所包含的一些字段以及其字节布局，包括:</p><ol><li>Destination MAC Address (6 octet) : 目标MAC地址。</li><li>Source MAC Address (6 octet) : 源MAC地址。</li><li>Type (2 octet) : PayLoad的类型字段。</li><li>PayLoad : <code>MTU=1500</code>。</li><li>CRC (4 octet) : 这部分并不会出现在链路层，而是底层使用的。</li></ol><h3 id=entre-type><i id=locator-entre-type class=header-locator></i>
<a href=#entre-type class=article-h-a>4.1.1 Enter Type</a></h3><p>常用到的几种Enter Type<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>。</p><table><thead><tr><th style=text-align:left>Enter Type</th><th style=text-align:left>Protocol</th></tr></thead><tbody><tr><td style=text-align:left>0x_08_00</td><td style=text-align:left><code>IPv4</code>(Internet Protocol Version 4)</td></tr><tr><td style=text-align:left>0x_08_06</td><td style=text-align:left><code>ARP</code>(Addreee Resolution Protocal)</td></tr><tr><td style=text-align:left>0x_81_00</td><td style=text-align:left><code>VLAN</code>(Virtual Local Area Network),<code>IEEE 802.1Q</code></td></tr><tr><td style=text-align:left>0x_86_DD</td><td style=text-align:left><code>IPv6</code>(Internet Protocal Version 6)</td></tr><tr><td style=text-align:left>0x_88_63</td><td style=text-align:left>PPPoE Discovery Stage</td></tr><tr><td style=text-align:left>0x_88_64</td><td style=text-align:left>PPPoE Session Stage</td></tr></tbody></table><h2 id=ieee-802-3-frame><i id=locator-ieee-802-3-frame class=header-locator></i>
<a href=#ieee-802-3-frame class=article-h-a>4.2 IEEE 802.3 Frame</a></h2><p>在<code>DIX V2</code>的基础上,IEEE 802委员会的802.3工作组制定了IEEE的Enternet标准<code>IEEE 802.3</code>。其并未对<code>DIX V2</code>的<code>Frame</code>格式做出变动，而只是扩充了一下<code>Type</code>字段的含义，是完全兼容<code>DIV V2</code>的。<code>IEEE 802.3</code>中<code>Type</code>字段表示两个含义，当它的值大于<code>0x0600</code>时，代表类型；小于时则代表Payload的长度。</p><h2 id=frame-type><i id=locator-frame-type class=header-locator></i>
<a href=#frame-type class=article-h-a>4.3 Frame Type</a></h2><p>这里的<code>Frame Type</code>和上文中的<code>Enter Type</code>不是一个概念。<code>Enter Type</code>指的指一个<code>Frame</code>内的<code>Payload</code>是什么类型的协议。而<code>Frame Type</code>指的是接收方收到的<code>Frame</code>属于哪种类型 :</p><ol><li><code>Unicast</code>单播 : 1:1, 发给本LAN的一个节点。</li><li><code>Broadcast</code>广播 : 1:N(全体), 发给本LAN所有节点。</li><li><code>Multicast</code>组播 : 1:N, 发给本LAN指定的多个节点。</li></ol><h1 id=arp><i id=locator-arp class=header-locator></i>
<a href=#arp class=article-h-a>5 ARP</a></h1><p>有了<code>MAC</code>和<code>Frame</code>就可以在LAN内进行通信了，但是有个问题，发送发怎么知道对方的<code>MAC</code>呢？这时候就需要专门的协议来解决这个问题了：</p><ol><li>IPv4 : <code>Broadcast</code>协议<code>ARP</code>(Addreee Resolution Protocal)<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>。</li><li>IPv6 : <code>Multicast</code>协议<code>ICMPv6</code>(Internet Control Message Protocol for IPv6)<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>中的<code>NDP</code>(Neighbor Discovery Protocol)负责。</li></ol><p>协议不同，但是解决的问题是同一个，一下有个简单的动图可以描述这个过程。</p><img src=arp.gif loading=lazy decoding=auto alt=MAC地址解析过程 title=MAC地址解析过程><blockquote><p>如果<code>LAN</code>中充斥着大量的<code>Broadcast</code>时，就很容易形成广播风暴，严重影响正常的<code>LAN</code>通信。所以在<code>IPv6</code>协议中，已经抛弃了对<code>Broadcast</code>的使用，而是使用<code>Multicast</code>替代。</p></blockquote><h1 id=valn><i id=locator-valn class=header-locator></i>
<a href=#valn class=article-h-a>6 VLAN</a></h1><p>VLAN(Virtual Local Area Network)也可以缓解上述提到的广播风暴，其作用是可以在物理的LAN上建立一个虚拟的LAN。把原本一个LAN的广播域隔离为一个个的虚拟的广播域。<code>IEEE 802.1Q</code>是<code>IEEE 802</code>委员会制定的VLAN标准。</p><h2 id=ieee-802-1q-frame><i id=locator-ieee-802-1q-frame class=header-locator></i>
<a href=#ieee-802-1q-frame class=article-h-a>6.1 IEEE 802.1Q Frame</a></h2><p>当<code>DIX V2</code>的<code>Type</code>字段的值为<code>0x_81_00</code>时，代表其Payload是VLAN(IEEE 802.1Q)<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>的帧格式<sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>。</p><div class="highlight-file highlight-file_opened" id=hf-fd38e2259653356da8774d8e06c9f26c><div class=highlight-file-header><a class="fa fa-plus highlight-file-switch" onclick='blog.toggleClassName("hf-fd38e2259653356da8774d8e06c9f26c","highlight-file_opened")'>vlan-frame.txt</a><a class="fa fa-download highlight-file-download" target=_blank href=/computer-networking/02-layer-data-link/vlan-frame.txt title="下载 vlan-frame.txt" download></a>
<a class="fa fa-github" target=_blank href=https://github.com/linianhui/blog/blob/main/src/computer-networking/02-layer-data-link/vlan-frame.txt title="源码 vlan-frame.txt"></a></div><div class=highlight-file-content><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>|                          IEEE 802.1Q                          |
</span></span><span style=display:flex><span>|- - - - - - - -+- - - 32 bit (4 octet)- - - - -+- - - - - - - -|
</span></span><span style=display:flex><span>|0 1 2 3 4 5 6 7+0 1 2 3 4 5 6 7+0 1 2 3 4 5 6 7+0 1 2 3 4 5 6 7|
</span></span><span style=display:flex><span>|- - - - - - - -+- - - - - - - -+- - - - - - - -+- - - - - - - -|
</span></span><span style=display:flex><span>| PCP |D| VID (VLAN identifier) |                               |
</span></span><span style=display:flex><span>|3 bit|E| 12 bit                +        Type (2 octet)         |
</span></span><span style=display:flex><span>|     |I| max = 0xFFF = 4096    |                               |
</span></span><span style=display:flex><span>|- - - - - - - -+- - - - - - - -+- - - - - - - -+- - - - - - - -|
</span></span><span style=display:flex><span>|                                                               |
</span></span><span style=display:flex><span>|               Payload (46-1500 octet)                         |
</span></span><span style=display:flex><span>|                                                               |
</span></span><span style=display:flex><span>|- - - - - - - -+- - - - - - - -+- - - - - - - -+- - - - - - - -|
</span></span><span style=display:flex><span>PCP = Priority code point
</span></span><span style=display:flex><span>DEI = Drop eligible indicator</span></span></code></pre></div></div></div><h1 id=device><i id=locator-device class=header-locator></i>
<a href=#device class=article-h-a>7 设备</a></h1><p>工作在数据链路层中的设备有很多 : 网卡、集线器和网桥、二层交换机（已称为以太网交换机）。</p><blockquote><p>集线器和网桥的组合它们的工作在<strong>半双工模式</strong>下，采用<code>CSMA/CD</code>协议检测冲突，虽然看起来是星型以太网，但是实际上还是总线型的。目前已被二层交换机替代了，所以就不再介绍集线器和网桥了。</p></blockquote><h2 id=switch><i id=locator-switch class=header-locator></i>
<a href=#switch class=article-h-a>7.1 交换机</a></h2><p>一个交换机可以组建一个星型以太网，交换机识别<code>Frame</code>，根据协议中的目标<code>MAC</code>进行转发来通信（目前有专门的硬件来负责，效率非常高）。交换机内置有一个<code>MAC Address Table</code>，通过自学习的方式积累记录着每个<code>MAC</code>对应的<code>Port</code>。</p><img src=switch.png loading=lazy decoding=auto alt=二层交换机 title=二层交换机><blockquote><p>注意<code>MAC Address Table</code>中<code>MAC</code>和<code>Port</code>的对应关系。其中<code>MAC</code>可以认为是key，<code>MAC</code>:<code>Port</code>是<code>1:1</code>; 但是反过<code>Port</code>:<code>MAC</code>则是1:N（也就是可能有N个<code>MAC</code>的<code>Port</code>是同一个）。</p></blockquote><h1 id=summary><i id=locator-summary class=header-locator></i>
<a href=#summary class=article-h-a>8 总结</a></h1><p>链路层的<mark>分组&交换</mark>：把物理层的01bit流<mark>分组</mark>成Frame，以及对Frame的差错检测。然后使用交换机来实现<mark>交换</mark>。</p><h1 id=leftover-problem><i id=locator-leftover-problem class=header-locator></i>
<a href=#leftover-problem class=article-h-a>9 遗留问题</a></h1><p>但是如果传输过程中<code>Frame</code>丢失了、重复了或者乱序了等等，链路层对这种错误则是无能为力的，所以链路层并不能对上层提供<strong>可靠传输(发送方按序发送，接收方按序接收)</strong>。这些问题就留给了更高层的协议来完成了。</p><h1 id=reference><i id=locator-reference class=header-locator></i>
<a href=#reference class=article-h-a>10 Reference</a></h1><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>MAC Address : <a href=https://en.wikipedia.org/wiki/MAC_address target=_blank rel="noopener norefferrer">https://en.wikipedia.org/wiki/MAC_address</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>DIX Ethernet V2 Frame : <a href=https://github.com/linianhui/networking/blob/master/1-src/networking.model/DataLink/EthernetFrame.Layout.cs target=_blank rel="noopener norefferrer">https://github.com/linianhui/networking/blob/master/1-src/networking.model/DataLink/EthernetFrame.Layout.cs</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>Enter Type : <a href=https://en.wikipedia.org/wiki/EtherType target=_blank rel="noopener norefferrer">https://en.wikipedia.org/wiki/EtherType</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>ARP : <a href=https://en.wikipedia.org/wiki/Address_Resolution_Protocol target=_blank rel="noopener norefferrer">https://en.wikipedia.org/wiki/Address_Resolution_Protocol</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>ICMPv6 : <a href=https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol_for_IPv6 target=_blank rel="noopener norefferrer">https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol_for_IPv6</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p>VLAN(IEEE 802.1Q) : <a href=https://en.wikipedia.org/wiki/IEEE_802.1Q target=_blank rel="noopener norefferrer">https://en.wikipedia.org/wiki/IEEE_802.1Q</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p>VLAN Frame : <a href=https://github.com/linianhui/networking/blob/master/1-src/networking.model/DataLink/VLANFrame.Layout.cs target=_blank rel="noopener norefferrer">https://github.com/linianhui/networking/blob/master/1-src/networking.model/DataLink/VLANFrame.Layout.cs</a>&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></section><section class=article-meta><section class=article-date>2019-09-22 08:12，约3237字，阅读约7分钟</section><section class=article-topics><a class=article-topic href=/computer-networking/ title=[计算机网络] target=_blank><i class="fa fa-folder"></i>[计算机网络]</a></section><section class=article-tags><a class=article-tag href=/tag/arp target=_blank><i class="fa fa-tag"></i>ARP</a>
<a class=article-tag href=/tag/crc target=_blank><i class="fa fa-tag"></i>CRC</a>
<a class=article-tag href=/tag/eot target=_blank><i class="fa fa-tag"></i>EOT</a>
<a class=article-tag href=/tag/esc target=_blank><i class="fa fa-tag"></i>ESC</a>
<a class=article-tag href=/tag/fcs target=_blank><i class="fa fa-tag"></i>FCS</a>
<a class=article-tag href=/tag/frame target=_blank><i class="fa fa-tag"></i>Frame</a>
<a class=article-tag href=/tag/icmpv6 target=_blank><i class="fa fa-tag"></i>ICMPv6</a>
<a class=article-tag href=/tag/l2-switch target=_blank><i class="fa fa-tag"></i>L2 Switch</a>
<a class=article-tag href=/tag/mac target=_blank><i class="fa fa-tag"></i>MAC</a>
<a class=article-tag href=/tag/mtu target=_blank><i class="fa fa-tag"></i>MTU</a>
<a class=article-tag href=/tag/soh target=_blank><i class="fa fa-tag"></i>SOH</a>
<a class=article-tag href=/tag/switch target=_blank><i class="fa fa-tag"></i>Switch</a>
<a class=article-tag href=/tag/%E4%BA%8C%E5%B1%82%E4%BA%A4%E6%8D%A2%E6%9C%BA target=_blank><i class="fa fa-tag"></i>二层交换机</a>
<a class=article-tag href=/tag/%E4%BA%A4%E6%8D%A2%E6%9C%BA target=_blank><i class="fa fa-tag"></i>交换机</a>
<a class=article-tag href=/tag/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E6%9C%BA target=_blank><i class="fa fa-tag"></i>以太网交换机</a>
<a class=article-tag href=/tag/%E5%B0%81%E8%A3%85%E6%88%90%E5%B8%A7 target=_blank><i class="fa fa-tag"></i>封装成帧</a>
<a class=article-tag href=/tag/%E5%B7%AE%E9%94%99%E6%A3%80%E6%B5%8B target=_blank><i class="fa fa-tag"></i>差错检测</a>
<a class=article-tag href=/tag/%E9%80%8F%E6%98%8E%E4%BC%A0%E8%BE%93 target=_blank><i class="fa fa-tag"></i>透明传输</a></section><section class=article-git><a class=article-git-commit href=https://github.com/linianhui/blog/commit/03e0cc08866458647d96951c1817c624518149d6 target=_blank><i class="fa fa-code-fork"></i>03e0cc0</a>
<span class=article-git-commit-subject>fix add displayed_on_home</span>
<span class=article-git-commit-time>2022-11-20 14:49</span>
<a class=article-git-source href=https://github.com/linianhui/blog/blob/main/src/computer-networking/02-layer-data-link/index.md target=_blank><i class="fa fa-github"></i>源码</a></section></section><section class=article-page><div class=article-page-prev><span>上一篇 : </span><a href=/computer-networking/01-layer-physical/ target=_blank>[计算机网络] 01 [Layer] Physical</a></div><div class=article-page-next><span>下一篇 : </span><a href=/computer-networking/03-layer-internet/ target=_blank>[计算机网络] 03 [Layer] Internet</a></div></section></article><section id=article-comment class=article-comment><script src=https://utteranc.es/client.js repo=linianhui/blog issue-term=pathname label=blog-comment theme=github-light crossorigin=anonymous async></script></section></main><footer class=footer><section>Copyright © 2025 by <a href=https://github.com/linianhui/blog target=_blank>Timetombs</a></section><section><a class=article-git-commit href=https://github.com/linianhui/blog/commit/2fac07e818d6d4ad6b78781efea82c28769c8c02 target=_blank><i class="fa fa-code-fork"></i>2fac07e</a>
Powered by
<a href=https://github.com/actions target=_blank>GitHub Actions</a>
,
<a href=https://github.com/gohugoio/hugo target=_blank>Hugo</a>
and
<a href=https://github.com/utterance/utterances target=_blank>utterances</a>
Hosted on <a href=https://pages.github.com/ target=_blank>GitHub Pages</a><section></footer></main><aside class=toolbar><a class="fa fa-list" href=javascript:blog.toggleToc(); title=目录></a><a class="fa fa-comments" href=#article-comment title=评论></a><a class="fa fa-arrow-up" href=javascript:scroll(0,0); title=返回顶部></a></aside><script type=text/javascript>var _hmt=_hmt||[];blog.addOnScorllEvent()</script><script src=https://hm.baidu.com/hm.js?b2cc3cea316e1f7a8def1bab8dc98fad async></script></body></html>